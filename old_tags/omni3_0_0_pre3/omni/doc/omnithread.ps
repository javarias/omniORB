%!PS-Adobe-2.0
%%Creator: dvipsk 5.58f Copyright 1986, 1994 Radical Eye Software
%%Title: omnithread.dvi
%%Pages: 6
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%DocumentFonts: Palatino-Roman Palatino-Italic Palatino-Bold Courier
%%DocumentPaperSizes: A4
%%EndComments
%DVIPSCommandLine: dvips -Pwood omnithread.dvi -o omnithread.ps
%DVIPSParameters: dpi=600, compressed, comments removed
%DVIPSSource:  TeX output 1997.05.12:1118
%%BeginProcSet: texc.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR[matrix currentmatrix{dup dup round sub abs 0.00001 lt{round}if}
forall round exch round exch]setmatrix}N /@landscape{/isls true N}B
/@manualfeed{statusdict /manualfeed true put}B /@copies{/#copies X}B
/FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{
/nn 8 dict N nn begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N
string /base X array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N
end dup{/foo setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{
/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]
N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data dup
length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{
128 ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub
get 127 sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data
dup type /stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N
/rc 0 N /gp 0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup
/base get 2 index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx
0 ch-xoff ch-yoff ch-height sub ch-xoff ch-width add ch-yoff
setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff
.1 sub]/id ch-image N /rw ch-width 7 add 8 idiv string N /rc 0 N /gp 0 N
/cp 0 N{rc 0 ne{rc 1 sub /rc X rw}{G}ifelse}imagemask restore}B /G{{id
gp get /gp gp 1 add N dup 18 mod S 18 idiv pl S get exec}loop}B /adv{cp
add /cp X}B /chg{rw cp id gp 4 index getinterval putinterval dup gp add
/gp X adv}B /nd{/cp 0 N rw exit}B /lsh{rw cp 2 copy get dup 0 eq{pop 1}{
dup 255 eq{pop 254}{dup dup add 255 and S 1 and or}ifelse}ifelse put 1
adv}B /rsh{rw cp 2 copy get dup 0 eq{pop 128}{dup 255 eq{pop 127}{dup 2
idiv S 128 and or}ifelse}ifelse put 1 adv}B /clr{rw cp 2 index string
putinterval adv}B /set{rw cp fillstr 0 4 index getinterval putinterval
adv}B /fillstr 18 string 0 1 17{2 copy 255 put pop}for N /pl[{adv 1 chg}
{adv 1 chg nd}{1 add chg}{1 add chg nd}{adv lsh}{adv lsh nd}{adv rsh}{
adv rsh nd}{1 add adv}{/rc X nd}{1 add set}{1 add clr}{adv 2 chg}{adv 2
chg nd}{pop nd}]dup{bind pop}forall N /D{/cc X dup type /stringtype ne{]
}if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup
length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{
cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul
add .99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore userdict
/eop-hook known{eop-hook}if showpage}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop product dup length 7 ge{0 7
getinterval dup(Display)eq exch 0 4 getinterval(NeXT)eq or}{pop false}
ifelse}{false}ifelse end{{gsave TR -.1 .1 TR 1 1 scale rulex ruley false
RMat{BDot}imagemask grestore}}{{gsave TR -.1 .1 TR rulex ruley scale 1 1
false RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath transform
round exch round exch itransform moveto rulex 0 rlineto 0 ruley neg
rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N /tail
{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{
4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{
p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p
a}B /bos{/SS save N}B /eos{SS restore}B end
%%EndProcSet
%%BeginFont: Palatino-Roman
% @@psencodingfile@{
%   author = "S. Rahtz, P. MacKay, Alan Jeffrey, B. Horn, K. Berry",
%   version = "0.6",
%   date = "22 June 1996",
%   filename = "8r.enc",
%   email = "kb@@mail.tug.org",
%   address = "135 Center Hill Rd. // Plymouth, MA 02360",
%   codetable = "ISO/ASCII",
%   checksum = "119     662    4424",
%   docstring = "Encoding for TrueType or Type 1 fonts to be used with TeX."
% @}
% 
% Idea is to have all the characters normally included in Type 1 fonts
% available for typesetting. This is effectively the characters in Adobe
% Standard Encoding + ISO Latin 1 + extra characters from Lucida.
% 
% Character code assignments were made as follows:
% 
% (1) the Windows ANSI characters are almost all in their Windows ANSI
% positions, because some Windows users cannot easily reencode the
% fonts, and it makes no difference on other systems. The only Windows
% ANSI characters not available are those that make no sense for
% typesetting -- rubout (127 decimal), nobreakspace (160), softhyphen
% (173). quotesingle and grave are moved just because it's such an
% irritation not having them in TeX positions.
% 
% (2) Remaining characters are assigned arbitrarily to the lower part
% of the range, avoiding 0, 10 and 13 in case we meet dumb software.
% 
% (3) Y&Y Lucida Bright includes some extra text characters; in the
% hopes that other PostScript fonts, perhaps created for public
% consumption, will include them, they are included starting at 0x12.
% 
% (4) Remaining positions left undefined are for use in (hopefully)
% upward-compatible revisions, if someday more characters are generally
% available.
% 
% (5) hyphen appears twice for compatibility with both ASCII and Windows.
% 
/TeXBase1Encoding [
% 0x00 (encoded characters from Adobe Standard not in Windows 3.1)
  /.notdef /dotaccent /fi /fl
  /fraction /hungarumlaut /Lslash /lslash
  /ogonek /ring /.notdef
  /breve /minus /.notdef 
% These are the only two remaining unencoded characters, so may as
% well include them.
  /Zcaron /zcaron 
% 0x10
 /caron /dotlessi 
% (unusual TeX characters available in, e.g., Lucida Bright)
 /dotlessj /ff /ffi /ffl 
 /.notdef /.notdef /.notdef /.notdef
 /.notdef /.notdef /.notdef /.notdef
 % very contentious; it's so painful not having quoteleft and quoteright
 % at 96 and 145 that we move the things normally found there down to here.
 /grave /quotesingle 
% 0x20 (ASCII begins)
 /space /exclam /quotedbl /numbersign
 /dollar /percent /ampersand /quoteright
 /parenleft /parenright /asterisk /plus /comma /hyphen /period /slash
% 0x30
 /zero /one /two /three /four /five /six /seven
 /eight /nine /colon /semicolon /less /equal /greater /question
% 0x40
 /at /A /B /C /D /E /F /G /H /I /J /K /L /M /N /O
% 0x50
 /P /Q /R /S /T /U /V /W
 /X /Y /Z /bracketleft /backslash /bracketright /asciicircum /underscore
% 0x60
 /quoteleft /a /b /c /d /e /f /g /h /i /j /k /l /m /n /o
% 0x70
 /p /q /r /s /t /u /v /w
 /x /y /z /braceleft /bar /braceright /asciitilde
 /.notdef % rubout; ASCII ends
% 0x80
 /.notdef /.notdef /quotesinglbase /florin
 /quotedblbase /ellipsis /dagger /daggerdbl
 /circumflex /perthousand /Scaron /guilsinglleft
 /OE /.notdef /.notdef /.notdef
% 0x90
 /.notdef /.notdef /.notdef /quotedblleft
 /quotedblright /bullet /endash /emdash
 /tilde /trademark /scaron /guilsinglright
 /oe /.notdef /.notdef /Ydieresis
% 0xA0
 /.notdef % nobreakspace
 /exclamdown /cent /sterling
 /currency /yen /brokenbar /section
 /dieresis /copyright /ordfeminine /guillemotleft
 /logicalnot
 /hyphen % Y&Y (also at 45); Windows' softhyphen
 /registered
 /macron
% 0xD0
 /degree /plusminus /twosuperior /threesuperior
 /acute /mu /paragraph /periodcentered
 /cedilla /onesuperior /ordmasculine /guillemotright
 /onequarter /onehalf /threequarters /questiondown
% 0xC0
 /Agrave /Aacute /Acircumflex /Atilde /Adieresis /Aring /AE /Ccedilla
 /Egrave /Eacute /Ecircumflex /Edieresis
 /Igrave /Iacute /Icircumflex /Idieresis
% 0xD0
 /Eth /Ntilde /Ograve /Oacute
 /Ocircumflex /Otilde /Odieresis /multiply
 /Oslash /Ugrave /Uacute /Ucircumflex
 /Udieresis /Yacute /Thorn /germandbls
% 0xE0
 /agrave /aacute /acircumflex /atilde
 /adieresis /aring /ae /ccedilla
 /egrave /eacute /ecircumflex /edieresis
 /igrave /iacute /icircumflex /idieresis
% 0xF0
 /eth /ntilde /ograve /oacute
 /ocircumflex /otilde /odieresis /divide
 /oslash /ugrave /uacute /ucircumflex
 /udieresis /yacute /thorn /ydieresis
] def
%%EndFont
%%BeginProcSet: texps.pro
TeXDict begin /rf{findfont dup length 1 add dict begin{1 index /FID ne 2
index /UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll
exec 0 exch 5 -1 roll VResolution Resolution div mul neg 0 0]/Metrics
exch def dict begin Encoding{exch dup type /integertype ne{pop pop 1 sub
dup 0 le{pop}{[}ifelse}{FontMatrix 0 get div Metrics 0 get div def}
ifelse}forall Metrics /Metrics currentdict end def[2 index currentdict
end definefont 3 -1 roll makefont /setfont load]cvx def}def
/ObliqueSlant{dup sin S cos div neg}B /SlantFont{4 index mul add}def
/ExtendFont{3 -1 roll mul exch}def /ReEncodeFont{/Encoding exch def}def
end
%%EndProcSet
TeXDict begin 39158280 55380996 1000 600 600 (omnithread.dvi)
@start /Fa 134[45 45 66 1[51 30 35 35 1[45 40 51 71 25
2[25 45 45 25 35 45 37 42 40 8[66 3[56 51 2[56 71 5[30
3[56 3[66 23[30 30 40[{ TeXBase1Encoding ReEncodeFont }31
91.249977 /Palatino-Italic rf /Fb 135[50 83 1[61 33 44
39 1[61 55 61 89 33 2[33 61 55 1[50 61 44 61 50 10[78
8[100 9[72 13[50 50 50 50 50 2[25 4[33 33 40[{
 TeXBase1Encoding ReEncodeFont }30 100.000000 /Palatino-Bold
rf /Fc 136[76 2[30 1[36 8[26 3[44 12[61 91 1[71 56 48
61 2[71 76 3[30 31 76 1[51 56 70 64 56 71 11[45 1[45
3[55 23 4[30 30 40[{ .167 SlantFont TeXBase1Encoding ReEncodeFont }28
91.249977 /Palatino-Roman rf /Fd 134[55 55 55 55 55 55
55 55 55 55 55 55 55 55 55 55 55 55 55 55 55 55 55 55
55 1[55 5[55 1[55 55 55 55 55 55 1[55 55 55 55 55 2[55
55 55 1[55 55 2[55 3[55 2[55 1[55 1[55 55 55 55 55 55
2[55 55 2[55 55 55 40[{ TeXBase1Encoding ReEncodeFont }58
91.249977 /Courier rf /Fe 1 16 df<EB0FFCEB3FFF90B512C0000314F04880488048
804880A2481580A3B712C0AA6C1580A36C1500A26C5C6C5C6C5C6C5CC614C0013F90C7FC
EB0FFC22227BA72D>15 D E /Ff 107[45 45 24[45 51 47 76
51 55 30 39 36 51 55 50 53 80 26 51 21 26 53 51 30 44
56 40 50 45 3[30 1[30 2[61 91 66 71 56 48 61 1[55 71
76 86 56 66 30 31 76 69 51 56 70 64 56 71 6[23 45 45
1[45 45 45 45 45 45 45 55 23 30 23 55 1[30 30 25 35[55
55 2[{ TeXBase1Encoding ReEncodeFont }73 91.249977 /Palatino-Roman
rf /Fg 134[66 60 100 1[73 40 53 47 1[73 66 73 106 2[40
40 73 66 47 60 73 53 73 60 11[93 80 73 86 2[100 100 120
3[47 19[60 60 60 60 60 1[35 47[{ TeXBase1Encoding ReEncodeFont }35
119.999947 /Palatino-Bold rf /Fh 137[50 2[39 9[28 3[39
50 17[66 82[{ TeXBase1Encoding ReEncodeFont }6 100.000000
/Palatino-Italic rf /Fi 134[55 2[56 1[32 42 39 2[54 58
88 29 2[29 58 55 1[48 61 44 55 50 12[61 1[67 2[78 1[94
61 8[71 9[50 1[50 3[50 1[50 10[78 38[{ TeXBase1Encoding ReEncodeFont }
28 100.000000 /Palatino-Roman rf /Fj 139[47 61 57 2[78
83 4[42 83 2[69 88 64 79 72 12[88 4[113 119 136 3[48
7[112 65[{ TeXBase1Encoding ReEncodeFont }18 144.000000
/Palatino-Roman rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 600dpi
TeXDict begin
%%PaperSize: A4

%%EndSetup
%%Page: 1 1
1 0 bop 881 763 a Fj(The)36 b(OMNI)g(Thr)m(ead)f(Abstraction)1446
1016 y Fi(T)-9 b(ristan)26 b(Richar)n(dson)1018 1132
y(Olivetti)g(&)e(Oracle)i(Resear)n(ch)e(Laboratory)1612
1248 y(Cambridge)1376 1455 y Fh(Revised)g Fi(13)h(Mar)n(ch)g(1997)150
1815 y Fg(1)119 b(Introduction)150 2026 y Ff(The)31 b(OMNI)g(thr)n(ead)
f(abstraction)i(is)f(designed)f(to)g(pr)n(ovide)h(a)h(common)f(set)g
(of)g(thr)n(ead)g(oper)n(-)150 2139 y(ations)h(for)f(use)g(in)i(pr)n
(ograms)e(written)g(in)h(C++.)57 b(Pr)n(ograms)31 b(written)g(using)h
(the)f(abstraction)150 2252 y(should)23 b(be)g(much)h(easier)f(to)g
(port)f(between)g(dif)n(fer)n(ent)i(ar)n(chitectur)n(es)f(with)h(dif)n
(fer)n(ent)f(underly-)150 2365 y(ing)g(thr)n(eads)e(primitives.)291
2478 y(The)28 b(pr)n(ogramming)h(interface)g(is)g(designed)d(to)i(be)h
(similar)h(to)e(the)g(C)h(language)g(interface)150 2591
y(to)g(POSIX)f(thr)n(eads)g(\(IEEE)g(draft)h(standar)n(d)g(1003.1c)i(-)
f(pr)n(eviously)f(1003.4a,)k(often)28 b(known)g(as)150
2704 y(\223pthr)n(eads\224)22 b([POSIX94)q(]\).)291 2817
y(Much)30 b(of)g(the)f(abstraction)h(consists)e(of)i(simple)f(C++)i
(object)e(wrappers)g(ar)n(ound)g(pthr)n(ead)150 2930
y(calls.)g(However)19 b(for)i(some)e(featur)n(es)h(such)h(as)g(thr)n
(ead-speci\002c)f(data,)h(a)g(better)f(interface)h(can)g(be)150
3042 y(of)n(fer)n(ed)h(because)g(of)h(the)f(use)g(of)g(C++.)291
3155 y(Some)k(of)h(the)g(mor)n(e)g(complex)g(featur)n(es)f(of)h(pthr)n
(eads)e(ar)n(e)j(not)e(supported)e(because)j(of)g(the)150
3268 y(dif)n(\002culty)c(of)f(ensuring)f(the)h(same)g(featur)n(es)f
(can)i(be)g(of)n(fer)n(ed)e(on)h(top)g(of)g(other)f(thr)n(ead)h
(systems.)150 3381 y(Such)36 b(featur)n(es)e(include)i(thr)n(ead)f
(cancellation)j(and)d(complex)h(scheduling)f(contr)n(ol)g(\(though)150
3494 y(simple)23 b(thr)n(ead)f(priorities)g(ar)n(e)h(supported\).)291
3607 y(The)30 b(abstraction)i(layer)f(is)g(curr)n(ently)g(implemented)f
(for)g(the)h(following)g(ar)n(chitectur)n(es)g(/)150
3720 y(thr)n(ead)22 b(systems:)286 3900 y Fe(\017)46
b Ff(Solaris)23 b(2.x)g(using)f(pthr)n(eads)f(draft)i(10)286
4077 y Fe(\017)46 b Ff(Solaris)23 b(2.x)g(using)f(solaris)h(thr)n(eads)
e(\(but)i(pthr)n(eads)e(version)h(is)h(now)f(standar)n(d\))286
4254 y Fe(\017)46 b Ff(Alpha)23 b(OSF1)g(using)f(pthr)n(eads)f(draft)i
(4)286 4430 y Fe(\017)46 b Ff(W)-5 b(indows)22 b(NT)g(using)g(NT)g(thr)
n(eads)286 4607 y Fe(\017)46 b Ff(Linux)23 b(2.x)f(using)g(Linuxthr)n
(ead)g(0.5)i(\(which)f(is)g(based)f(on)g(pthr)n(eads)f(draft)i(10\))286
4784 y Fe(\017)46 b Ff(Linux)23 b(2.x)f(using)g(MIT)h(pthr)n(eads)e
(\(which)i(is)g(based)f(on)g(draft)h(8\))286 4961 y Fe(\017)46
b Ff(A)-7 b(TMos)22 b(using)g(pthr)n(eads)f(draft)i(6)291
5141 y(See)e(the)g Fd(omnithread.h)c Ff(header)k(\002le)i(for)f(full)h
(details)f(of)g(the)f(API.)g(The)h(descriptions)e(be-)150
5254 y(low)k(assume)g(you)f(have)i(some)e(pr)n(evious)h(knowledge)e(of)
i(thr)n(eads,)g(mutexes,)f(condition)h(vari-)150 5367
y(ables)i(and)f(semaphor)n(es.)35 b(Also)25 b(r)n(efer)g(to)g(other)f
(documentation)g(\([Birr)n(ell89)r(],)j([POSIX94]\))f(for)150
5479 y(further)g(explanation)i(of)f(these)e(ideas)i(\(particularly)i
(condition)e(variables,)j(the)c(use)g(of)i(which)150
5592 y(may)23 b(not)f(be)g(particularly)i(intuitive)f(when)f(\002rst)g
(encounter)n(ed\).)1837 5841 y(1)p eop
%%Page: 2 2
2 1 bop 30 100 a Ff(2)2494 b Fc(3)92 b(THREAD)21 b(OBJECT)30
399 y Fg(2)119 b(Synchronisation)31 b(objects)30 622
y Ff(Synchr)n(onisation)17 b(objects)f(ar)n(e)i(used)d(to)i(synchr)n
(onise)f(thr)n(eads)g(within)i(the)e(same)h(pr)n(ocess.)25
b(Ther)n(e)30 735 y(is)30 b(no)g(inter)n(-pr)n(ocess)f(synchr)n
(onisation)h(pr)n(ovided.)49 b(The)30 b(synchr)n(onisation)f(objects)h
(pr)n(ovided)30 848 y(ar)n(e)23 b(mutexes,)e(condition)h(variables)i
(and)f(counting)f(semaphor)n(es.)30 1141 y Fb(2.1)99
b(Mutex)30 1331 y Ff(An)28 b(object)g(of)g(type)f Fd(omni)p
985 1331 28 4 v 31 w(mutex)f Ff(is)i(used)f(for)h(mutual)g(exclusion.)
44 b(It)28 b(pr)n(ovides)f(two)h(opera-)30 1444 y(tions,)h
Fd(lock\(\))e Ff(and)i Fd(unlock\(\))p Ff(.)43 b(The)28
b(alternative)h(names)g Fd(acquire\(\))c Ff(and)k Fd(release\(\))30
1557 y Ff(can)f(be)e(used)g(if)h(pr)n(eferr)n(ed.)39
b(Behaviour)27 b(is)f(unde\002ned)f(when)h(a)h(thr)n(ead)g(attempts)e
(to)h(lock)h(the)30 1670 y(same)22 b(mutex)g(again)i(or)e(when)g(a)h
(mutex)f(is)g(locked)g(by)h(one)e(thr)n(ead)h(and)h(unlocked)e(by)i(a)g
(dif)n(fer)n(-)30 1783 y(ent)f(thr)n(ead.)30 2076 y Fb(2.2)99
b(Condition)26 b(V)-11 b(ariable)30 2265 y Ff(A)19 b(condition)h
(variable)h(is)f(r)n(epr)n(esented)d(by)i(an)i Fd(omni)p
1911 2265 V 30 w(condition)16 b Ff(and)k(is)g(used)e(for)h(signalling)
30 2378 y(between)33 b(thr)n(eads.)63 b(A)34 b(call)j(to)d
Fd(wait\(\))e Ff(causes)i(a)h(thr)n(ead)f(to)g(wait)h(on)f(the)g
(condition)h(vari-)30 2491 y(able.)47 b(A)29 b(call)i(to)d
Fd(signal\(\))e Ff(wakes)i(up)g(at)h(least)g(one)f(thr)n(ead)g(if)i
(any)f(ar)n(e)g(waiting.)47 b(A)29 b(call)i(to)30 2604
y Fd(broadcast\(\))18 b Ff(wakes)j(up)i(all)h(thr)n(eads)d(waiting)i
(on)g(the)e(condition)i(variable.)171 2723 y(When)i(constr)o(ucted,)f
(a)i(pointer)e(to)h(an)h Fd(omni)p 1799 2723 V 31 w(mutex)d
Ff(must)i(be)g(given.)36 b(A)25 b(condition)h(vari-)30
2836 y(able)k Fd(wait\(\))d Ff(has)j(an)g(implicit)h(mutex)e
Fd(unlock\(\))d Ff(and)j Fd(lock\(\))e Ff(ar)n(ound)i(it.)49
b(The)29 b(link)h(be-)30 2949 y(tween)j(condition)h(variable)j(and)d
(mutex)g(lasts)g(for)h(the)e(lifetime)j(of)e(the)g(condition)g
(variable)30 3062 y(\(unlike)23 b(pthr)n(eads)g(wher)n(e)f(the)h(link)h
(is)f(only)g(for)g(the)g(duration)g(of)g(the)g(wait\).)31
b(The)22 b(same)i(mutex)30 3175 y(may)f(be)g(used)e(with)h(several)h
(condition)f(variables.)171 3294 y(A)f(wait)h(with)g(a)g(timeout)e(can)
j(be)e(achieved)h(by)f(calling)i Fd(timed)p 2420 3294
V 31 w(wait\(\))p Ff(.)h(This)e(is)f(given)h(an)30 3407
y(absolute)h(time)h(to)g(wait)g(until.)33 b(The)23 b(r)n(outine)g
Fd(omni)p 1863 3407 V 31 w(thread::get)p 2499 3407 V
28 w(time\(\))e Ff(can)k(be)f(used)f(to)30 3520 y(turn)i(a)i(r)n
(elative)g(time)f(into)g(an)g(absolute)g(time.)38 b Fd(timed)p
2029 3520 V 31 w(wait\(\))23 b Ff(r)n(eturns)i Fd(ETIMEDOUT)d
Ff(if)27 b(the)30 3633 y(time)c(expir)n(es)e(befor)n(e)i(the)e
(condition)i(variable)h(is)f(signalled.)30 3926 y Fb(2.3)99
b(Counting)26 b(semaphores)30 4116 y Ff(An)32 b Fd(omni)p
411 4116 V 31 w(semaphore)c Ff(is)k(a)h(counting)e(semaphor)n(e.)55
b(When)32 b(cr)n(eated)f(it)h(is)h(given)f(an)g(initial)30
4229 y(unsigned)h(integer)g(value.)64 b(When)34 b Fd(wait\(\))e
Ff(is)i(called,)k(the)c(value)h(is)g(decr)n(emented)d(if)j(non-)30
4342 y(zer)n(o.)49 b(If)30 b(the)f(value)i(is)f(zer)n(o)g(then)f(the)g
(thr)n(ead)g(blocks)h(instead.)49 b(When)29 b Fd(post\(\))e
Ff(is)j(called,)i(if)30 4454 y(any)27 b(thr)n(eads)f(ar)n(e)h(blocked)f
(in)h Fd(wait\(\))p Ff(,)e(exactly)i(one)f(thr)n(ead)g(is)h(woken.)39
b(If)27 b(no)f(thr)n(eads)g(wer)n(e)30 4567 y(blocked)c(then)g(the)g
(value)h(of)g(the)e(semaphor)n(e)h(is)h(incr)n(emented.)171
4687 y(If)d(a)g(thr)n(ead)g(calls)h Fd(try)p 966 4687
V 31 w(wait\(\))p Ff(,)d(then)h(the)g(thr)n(ead)g(won't)g(block)h(if)h
(the)e(semaphor)n(e's)f(value)30 4799 y(is)23 b(0,)g(r)n(eturning)e
Fd(EAGAIN)f Ff(instead.)171 4919 y(At)i(pr)n(esent)f(ther)n(e)h(is)g
(no)h(way)f(of)h(querying)e(the)h(value)h(of)g(the)f(semaphor)n(e.)30
5256 y Fg(3)119 b(Thread)29 b(object)30 5479 y Ff(A)e(thr)n(ead)h(is)f
(r)n(epr)n(esented)e(by)j(an)g Fd(omni)p 1492 5479 V
31 w(thread)d Ff(object.)43 b(Ther)n(e)26 b(ar)n(e)i(br)n(oadly)g(two)f
(dif)n(fer)n(ent)30 5592 y(ways)22 b(in)h(which)g(it)g(can)h(be)e
(used.)p eop
%%Page: 3 3
3 2 bop 3525 100 a Ff(3)291 399 y(The)22 b(\002rst)g(way)h(is)f(simply)
h(to)f(cr)n(eate)h(an)g Fd(omni)p 1938 399 28 4 v 31
w(thread)d Ff(object,)i(giving)h(a)g(particular)h(func-)150
511 y(tion)19 b(which)i(the)e(thr)n(ead)g(should)g(execute.)25
b(This)19 b(is)h(like)g(the)f(POSIX)g(\(or)h(any)f(other\))g(C)h
(language)150 624 y(interface.)291 741 y(The)d(second)e(method)h(of)h
(use)g(is)g(to)f(cr)n(eate)h(a)h(new)f(class)g(which)h(inherits)f(fr)n
(om)g Fd(omni)p 3256 741 V 31 w(thread)p Ff(.)150 854
y(In)22 b(this)h(case)f(the)g(thr)n(ead)h(will)h(execute)d(the)h
Fd(run\(\))e Ff(member)j(function)g(of)f(the)g(new)h(class.)28
b(One)150 967 y(advantage)g(of)g(this)g(scheme)f(is)h(that)g(thr)n
(ead-speci\002c)f(data)i(can)f(be)g(implemented)f(simply)h(by)150
1080 y(having)23 b(data)g(members)f(of)h(the)f(new)g(class.)291
1196 y(When)38 b(constr)o(ucted)e(a)j(thr)n(ead)f(is)g(in)h(the)e
(\224new\224)h(state)g(and)g(has)g(not)g(actually)h(started.)150
1309 y(A)31 b(call)j(to)d Fd(start\(\))d Ff(causes)j(the)g(thr)n(ead)g
(to)g(begin)g(executing.)53 b(A)32 b(static)g(member)f(function)150
1422 y Fd(create\(\))23 b Ff(is)k(pr)n(ovided)f(to)g(constr)o(uct)g
(and)g(start)g(a)i(thr)n(ead)e(in)h(a)g(single)f(call.)42
b(A)27 b(thr)n(ead)f(exits)150 1535 y(by)d(calling)h
Fd(exit\(\))c Ff(or)i(by)h(r)n(eturning)e(fr)n(om)j(the)d(thr)n(ead)i
(function.)291 1651 y(Thr)n(eads)k(can)h(be)g(either)e(detached)g(or)h
(undetached.)41 b(Detached)27 b(thr)n(eads)g(ar)n(e)h(thr)n(eads)e(for)
150 1764 y(which)18 b(all)i(state)c(will)j(be)f(lost)f(upon)g(exit.)26
b(Other)17 b(thr)n(eads)g(cannot)h(determine)e(when)h(a)h(detached)150
1877 y(thr)n(ead)33 b(will)h(disappear)-7 b(,)35 b(and)e(ther)n(efor)n
(e)f(should)g(not)g(attempt)g(to)h(access)f(the)h(thr)n(ead)f(object)
150 1990 y(unless)24 b(some)g(explicit)i(synchr)n(onisation)e(with)h
(the)g(detached)e(thr)n(ead)i(guarantees)e(that)i(it)g(still)150
2103 y(exists.)291 2220 y(Undetached)i(thr)n(eads)g(ar)n(e)i(thr)n
(eads)f(for)g(which)h(storage)e(is)i(not)f(r)n(eclaimed)h(until)g
(another)150 2332 y(thr)n(ead)23 b(waits)h(for)g(its)g(termination)g
(by)g(calling)h Fd(join\(\))p Ff(.)30 b(An)23 b(exit)h(value)h(can)f
(be)g(passed)f(fr)n(om)150 2445 y(an)g(undetached)e(thr)n(ead)h(to)g
(the)g(thr)n(ead)g(which)h(joins)g(it.)291 2562 y(Detached)43
b(/)h(undetached)f(thr)n(eads)f(ar)n(e)j(distinguished)c(on)j(cr)n
(eation)g(by)g(the)f(type)f(of)150 2675 y(function)34
b(they)f(execute.)60 b(Undetached)32 b(thr)n(eads)h(execute)g(a)h
(function)g(which)h(has)f(a)g Fd(void*)150 2788 y Ff(r)n(eturn)42
b(type,)47 b(wher)n(eas)42 b(detached)g(thr)n(eads)h(execute)e(a)j
(function)f(which)h(has)g(a)f Fd(void)f Ff(r)n(e-)150
2901 y(turn)47 b(type.)100 b(Unfortunately)46 b(C++)j(member)e
(functions)g(ar)n(e)h(not)f(allowed)g(to)g(be)g(distin-)150
3014 y(guished)k(simply)h(by)g(their)g(r)n(eturn)f(type.)115
b(Thus)52 b(in)g(the)g(case)g(of)g(a)h(derived)e(class)i(of)150
3126 y Fd(omni)p 375 3126 V 31 w(thread)22 b Ff(which)j(needs)e(an)i
(undetached)e(thr)n(ead,)h(the)g(member)g(function)h(executed)d(by)150
3239 y(the)17 b(thr)n(ead)h(is)g(called)h Fd(run)p 1083
3239 V 31 w(undetached\(\))13 b Ff(rather)k(than)h Fd(run\(\))p
Ff(,)f(and)h(it)g(is)g(started)e(by)i(calling)150 3352
y Fd(start)p 430 3352 V 30 w(undetached\(\))g Ff(instead)k(of)g
Fd(start\(\))p Ff(.)291 3469 y(The)37 b(abstraction)i(curr)n(ently)e
(supports)e(thr)n(ee)i(priorities)g(of)h(thr)n(ead,)j(but)d(no)f
(guarantee)150 3582 y(is)e(made)g(of)g(how)g(this)f(will)j(af)n(fect)f
(underlying)e(thr)n(ead)g(scheduling.)64 b(The)35 b(thr)n(ee)f
(priorities)150 3695 y(ar)n(e)24 b Fd(PRIORITY)p 742
3695 V 29 w(LOW)p Ff(,)e Fd(PRIORITY)p 1421 3695 V 30
w(NORMAL)f Ff(and)i Fd(PRIORITY)p 2419 3695 V 30 w(HIGH)p
Ff(.)e(By)i(default)h(all)h(thr)n(eads)150 3808 y(r)o(un)e(at)g
Fd(PRIORITY)p 859 3808 V 29 w(NORMAL)p Ff(.)c(A)k(dif)n(fer)n(ent)g
(priority)f(can)h(be)g(speci\002ed)e(on)h(thr)n(ead)h(cr)n(eation,)f
(or)150 3920 y(while)29 b(the)f(thr)n(ead)g(is)h(r)o(unning)g(using)f
Fd(set)p 1720 3920 V 31 w(priority\(\).)42 b Ff(A)29
b(thr)n(ead's)f(curr)n(ent)g(priority)g(is)150 4033 y(r)n(eturned)21
b(by)h Fd(priority\(\))p Ff(.)291 4150 y(Other)65 b(functions)g(pr)n
(ovided)g(ar)n(e)h Fd(self\(\))d Ff(which)j(r)n(eturns)e(the)h(calling)
i(thr)n(ead's)150 4263 y Fd(omni)p 375 4263 V 31 w(thread)23
b Ff(object,)k Fd(yield\(\))c Ff(which)k(r)n(equests)d(that)i(other)f
(thr)n(eads)g(be)h(allowed)g(to)f(r)o(un,)150 4376 y
Fd(id\(\))37 b Ff(which)h(r)n(eturns)f(an)i(integer)e(id)i(for)f(the)f
(thr)n(ead)h(for)g(use)f(in)i(debugging,)h Fd(state\(\))p
Ff(,)150 4489 y Fd(sleep\(\))20 b Ff(and)i Fd(get)p 901
4489 V 32 w(time\(\))p Ff(.)150 4810 y Fg(4)119 b(Using)31
b(OMNI)d(threads)h(in)g(your)i(program)150 5028 y Ff(Obviously)e(you)f
(need)f(to)h(include)h(the)f Fd(omnithread.h)23 b Ff(header)28
b(\002le)h(in)g(your)e(sour)n(ce)h(code,)150 5141 y(and)34
b(link)g(in)g(the)e(omnithr)n(ead)i(library)g(with)g(your)e
(executable.)61 b(Because)32 b(ther)n(e)h(is)g(a)i(single)150
5254 y Fd(omnithread.h)17 b Ff(for)23 b(all)h(platforms,)e(certain)h
(pr)n(epr)n(ocessor)e(de\002nes)g(must)h(be)g(given)h(as)f(com-)150
5367 y(piler)k(options.)36 b(The)25 b(easiest)g(way)h(to)f(do)g(this)h
(is)g(to)f(study)f(the)h(make\002les)g(given)h(in)g(the)g(exam-)150
5479 y(ples)c(pr)n(ovided)g(with)g(this)g(distribution.)28
b(If)22 b(you)g(ar)n(e)h(to)f(include)h(OMNI)f(thr)n(eads)g(in)h(your)f
(own)150 5592 y(development)f(envir)n(onment,)h(these)f(ar)n(e)i(the)e
(necessary)h(pr)n(epr)n(ocessor)e(de\002nes:)p eop
%%Page: 4 4
4 3 bop 30 100 a Ff(4)1498 b Fc(5)91 b(THREADED)21 b(I/O)i(SHUTDOWN)f
(FOR)g(UNIX)p 171 311 3669 4 v 169 423 4 113 v 221 390
a Ff(Platform)p 1120 423 V 599 w(Pr)n(epr)n(ocessor)e(De\002nes)p
3838 423 V 171 427 3669 4 v 171 443 V 169 556 4 113 v
221 522 a(Sun)i(Solaris)h(2.x)p 1120 556 V 365 w Fd(-D__sunos__)49
b(-D__sparc__)h(-D__OSVERSION__)o(=5)e(-DSVR4)p 3838
556 V 169 669 V 1120 669 V 1172 635 a(-DUsePthread)h(-D_REENTRANT)p
3838 669 V 171 672 3669 4 v 169 785 4 113 v 221 752 a
Ff(Digital)24 b(Unix)f(3.2)p 1120 785 V 320 w Fd(-D__osf1__)50
b(-D__alpha__)f(-D__OSVERSION__=)o(3)p 3838 785 V 169
898 V 1120 898 V 1172 864 a(-D_REENTRANT)p 3838 898 V
171 902 3669 4 v 169 1015 4 113 v 221 981 a Ff(x86)23
b(Linux)g(2.0)p 1120 1015 V 418 w Fd(-D__linux__)49 b(-D__i86__)i
(-D__OSVERSION__)o(=2)p 3838 1015 V 169 1127 V 221 1094
a Ff(with)22 b(linuxthr)n(eads)h(0.5)p 1120 1127 V 100
w Fd(-D_REENTRANT)p 3838 1127 V 171 1131 3669 4 v 169
1244 4 113 v 221 1210 a Ff(W)-5 b(indows)21 b(NT)p 1120
1244 V 412 w Fd(-D__NT__)51 b(-MD)p 3838 1244 V 171 1247
3669 4 v 30 1529 a Fg(5)119 b(Threaded)29 b(I/O)g(shutdown)h(for)g
(Unix)30 1753 y Ff(or)-7 b(,)23 b(how)g(one)f(thr)n(ead)h(should)f
(tell)h(another)g(thr)n(ead)f(to)h(shut)f(down)g(when)h(it)g(might)g
(be)g(doing)g(a)30 1866 y(blocking)g(call)h(on)f(a)g(socket.)171
1985 y(Unfortunately)e(ther)n(e)g(doesn't)g(seem)g(to)h(be)g(a)h
(standar)n(d)f(way)h(of)f(doing)g(this)g(which)h(works)30
2098 y(acr)n(oss)36 b(all)i(Unix)e(systems.)66 b(I)36
b(have)h(investigated)d(the)i(behaviour)g(of)h(our)e(two)h(main)h(Unix)
30 2211 y(platforms,)i(Solaris)c(2.5)i(and)f(Digital)h(Unix)e(3.2.)68
b(On)36 b(Digital)h(Unix)f(everything)e(is)i(\002ne,)i(as)30
2324 y(the)29 b(obvious)g(method)g(using)g(shutdown\(\))f(seems)g(to)h
(work)f(OK.)i(Unfortunately)f(on)g(Solaris)30 2437 y(shutdown)24
b(can)i(only)f(be)h(used)e(on)i(a)g(connected)e(socket,)h(so)g(we)g
(need)f(devious)h(means)g(to)g(get)30 2550 y(ar)n(ound)d(this)h
(limitation.)29 b(The)22 b(details)g(ar)n(e)h(summarised)f(below:)30
2843 y Fb(5.1)99 b(read\(\))30 3033 y Ff(Thr)n(ead)23
b(A)h(is)g(in)g(a)g(loop,)f(doing)g(r)n(ead\(sock\),)g(pr)n(ocessing)g
(the)f(data,)i(then)f(going)g(back)h(into)g(the)30 3146
y(r)n(ead.)171 3265 y(Thr)n(ead)d(B)g(comes)g(along)h(and)f(wants)g(to)
g(shut)g(it)g(down)g(-)h(it)f(can't)i(cancel)f(thr)n(ead)f(A)h(since)f
(\(i\))30 3378 y(working)k(out)h(how)g(to)f(clean)i(up)f(accor)n(ding)h
(to)f(wher)n(e)f(A)i(is)f(in)h(its)f(loop)g(is)g(a)h(nightmar)n(e,)g
(and)30 3491 y(\(ii\))d(this)e(isn't)h(available)j(in)d(omnithr)n(ead)f
(anyway)-10 b(.)171 3610 y(On)23 b(Solaris)g(2.5)g(and)g(Digital)h
(Unix)f(3.2)g(the)f(following)h(strategy)e(works:)171
3729 y(Thr)n(ead)h(B)h(does)e(shutdown\(sock,2\).)171
3848 y(At)30 b(this)g(point)g(thr)n(ead)g(A)g(is)h(either)e(blocked)h
(inside)g(r)n(ead\(sock\),)i(or)e(is)g(elsewher)n(e)f(in)i(the)30
3961 y(loop.)39 b(If)26 b(the)f(former)i(then)e(r)n(ead)h(will)i(r)n
(eturn)e(0,)h(indicating)g(that)f(the)g(socket)f(is)h(closed.)39
b(If)26 b(the)30 4074 y(latter)c(then)f(eventually)h(thr)n(ead)g(A)g
(will)i(call)g(r)n(ead\(sock\))e(and)g(then)f(this)h(will)i(r)n(eturn)d
(0.)29 b(Thr)n(ead)30 4187 y(A)22 b(should)g(close\(sock\),)g(do)g(any)
g(other)g(tidying)f(up,)h(and)h(exit.)171 4306 y(If)h(ther)n(e)e(is)i
(another)f(point)g(in)h(the)f(loop)g(that)g(thr)n(ead)g(A)h(can)g
(block)g(then)f(obviously)h(thr)n(ead)30 4419 y(B)d(needs)f(to)g(be)i
(awar)n(e)g(of)f(this)g(and)g(be)h(able)g(to)f(wake)f(it)i(up)f(in)h
(the)e(appr)n(opriate)h(way)g(fr)n(om)h(that)30 4532
y(point.)30 4826 y Fb(5.2)99 b(accept\(\))30 5015 y Ff(Again)29
b(thr)n(ead)g(A)g(is)g(in)h(a)g(loop,)g(this)e(time)i(doing)e(an)i
(accept)f(on)g(listenSock,)g(dealing)g(with)h(a)30 5128
y(new)22 b(connection)g(and)h(going)f(back)h(into)f(accept.)28
b(Thr)n(ead)22 b(B)h(wants)f(to)g(cancel)i(it.)171 5247
y(On)f(Digital)h(Unix)f(3.2)g(the)f(strategy)f(is)h(identical)i(to)e
(that)g(for)h(r)n(ead:)171 5367 y(Thr)n(ead)h(B)f(does)g
(shutdown\(listenSock,2\).)29 b(Wher)n(ever)23 b(thr)n(ead)h(A)g(is)g
(in)g(the)f(loop,)h(eventu-)30 5479 y(ally)h(it)e(will)i(r)n(eturn)e
(ECONNABOR)m(TED)f(fr)n(om)i(the)f(accept)g(call.)33
b(It)23 b(should)f(close\(listenSock\),)30 5592 y(tidy)g(up)g(as)h
(necessary)e(and)i(exit.)p eop
%%Page: 5 5
5 4 bop 150 100 a Fc(5.3)92 b(write\(\))2898 b Ff(5)291
399 y(On)42 b(Solaris)g(2.5)h(thr)n(ead)e(B)g(can't)i(do)e
(shutdown\(listenSock,2\))e(-)j(this)f(r)n(eturns)f(ENOT)-5
b(-)150 511 y(CONN.)22 b(Instead)f(the)h(following)h(strategy)e(can)i
(be)g(used:)291 626 y(First)h(thr)n(ead)f(B)h(sets)f(some)g(sort)g(of)i
(\224shutdown)d(\003ag\224)j(associated)f(with)g(listenSock.)32
b(Then)150 739 y(it)c(does)e(getsockaddr\(listenSock\))e(to)j(\002nd)h
(out)e(which)j(port)d(listenSock)h(is)h(on)f(\(or)h(knows)e(al-)150
851 y(r)n(eady\),)h(sets)d(up)i(a)h(socket)d(dummySock,)i(does)f
(connect\(dummySock,)g(this)h(host,)g(port\))f(and)150
964 y(\002nally)f(does)d(close\(dummySock\).)291 1079
y(Now)30 b(wher)n(ever)g(thr)n(ead)g(A)h(is)g(in)g(the)f(loop,)i
(eventually)f(it)g(will)h(call)h(accept\(listenSock\).)150
1191 y(This)25 b(will)h(r)n(eturn)e(successfully)g(with)h(a)g(new)f
(socket,)g(say)g(connSock.)34 b(Thr)n(ead)24 b(A)h(then)f(checks)150
1304 y(to)k(see)f(if)j(the)d(\224shutdown)g(\003ag\224)j(is)e(set.)45
b(If)29 b(not,)g(then)e(it's)i(a)g(normal)g(connection.)46
b(If)28 b(it)h(is)g(set,)150 1417 y(then)22 b(thr)n(ead)g(A)g(closes)g
(listenSock)g(and)g(connSock,)g(tidies)g(up)g(and)h(exits.)150
1680 y Fb(5.3)99 b(write\(\))150 1859 y Ff(Thr)n(ead)27
b(A)g(may)h(be)g(blocked)f(in)h(write,)g(or)f(about)h(to)f(go)f(in)i
(to)f(a)h(potentially-blocking)g(write.)150 1972 y(Thr)n(ead)22
b(B)g(wants)h(to)f(shut)f(it)i(down.)291 2086 y(On)g(Solaris)g(2.5:)291
2201 y(Thr)n(ead)f(B)h(does)e(shutdown\(sock,2\).)291
2315 y(If)30 b(thr)n(ead)g(A)g(is)g(alr)n(eady)h(in)f(write\(sock\))f
(then)h(it)g(will)h(r)n(eturn)f(with)g(ENXIO.)f(If)h(thr)n(ead)f(A)150
2428 y(calls)24 b(write)e(after)h(thr)n(ead)f(B)g(calls)i(shutdown)d
(this)h(will)i(r)n(eturn)e(EIO.)291 2542 y(On)h(Digital)h(Unix)f(3.2:)
291 2656 y(Thr)n(ead)f(B)h(does)e(shutdown\(sock,2\).)291
2770 y(If)g(thr)n(ead)g(A)g(is)g(alr)n(eady)g(in)h(write\(sock\))e
(then)g(it)h(will)i(r)n(eturn)d(the)g(number)h(of)g(bytes)f(written)150
2883 y(befor)n(e)27 b(it)h(became)g(blocked.)42 b(A)27
b(subsequent)e(call)k(to)e(write)g(will)i(then)d(generate)g(SIGPIPE)g
(\(or)150 2996 y(EPIPE)21 b(will)j(be)f(r)n(eturned)e(if)i(SIGPIPE)f
(is)g(ignor)n(ed)g(by)g(the)g(thr)n(ead\).)150 3259 y
Fb(5.4)99 b(connect\(\))150 3438 y Ff(Thr)n(ead)25 b(A)g(may)g(be)g
(blocked)g(in)g(connect,)g(or)g(about)g(to)g(go)f(in)i(to)e(a)i
(potentially-blocking)f(con-)150 3551 y(nect.)i(Thr)n(ead)c(B)f(wants)g
(to)g(shut)g(it)g(down.)291 3665 y(On)h(Digital)h(Unix)f(3.2:)291
3779 y(Thr)n(ead)f(B)h(does)e(shutdown\(sock,2\).)291
3894 y(If)26 b(thr)n(ead)f(A)h(is)g(alr)n(eady)g(in)g(connect\(sock\))f
(then)g(it)h(will)h(r)n(eturn)e(a)i(successful)e(connection.)150
4007 y(Subsequent)18 b(r)n(eading)i(or)g(writing)g(will)i(show)d(that)h
(the)f(socket)g(has)h(been)g(shut)f(down)g(\(i.e.)27
b(r)n(ead)150 4119 y(r)n(eturns)h(0,)j(write)d(generates)f(SIGPIPE)g
(or)i(r)n(eturns)f(EPIPE\).)f(If)i(thr)n(ead)g(A)f(calls)j(connect)d
(after)150 4232 y(thr)n(ead)22 b(B)g(calls)i(shutdown)d(this)h(will)i
(r)n(eturn)e(EINV)-10 b(AL.)291 4347 y(On)23 b(Solaris)g(2.5:)291
4461 y(Ther)n(e)h(is)i(no)f(way)g(to)f(wake)h(up)g(a)h(thr)n(ead)f
(which)g(is)h(blocked)e(in)i(connect.)35 b(Instead)24
b(Solaris)150 4574 y(for)n(ces)e(us)g(thr)n(ough)g(a)h(ridiculous)g(pr)
n(ocedur)n(e)e(whichever)i(way)f(we)g(try)g(it.)28 b(One)23
b(way)f(is)h(this:)291 4688 y(First)28 b(thr)n(ead)g(A)g(cr)n(eates)g
(a)h(pipe)f(in)h(addition)g(to)f(the)f(socket.)44 b(Instead)27
b(of)i(shutting)e(down)150 4801 y(the)22 b(socket,)f(thr)n(ead)h(B)g
(simply)h(writes)e(a)i(byte)f(to)g(the)g(pipe.)291 4915
y(Thr)n(ead)44 b(A)g(meanwhile)h(sets)e(the)g(socket)g(non-blocking)i
(using)e(fcntl\(sock,)50 b(F)p 3255 4915 28 4 v 32 w(SETFL,)150
5028 y(O)p 226 5028 V 33 w(NONBLOCK\).)22 b(Then)e(it)i(calls)h
(connect)f(on)f(the)g(socket)f(-)i(this)f(will)i(r)n(eturn)e
(EINPROGRESS.)150 5141 y(Then)26 b(it)h(must)f(call)j(select,)e
(waiting)g(for)f(either)g(sock)g(to)g(become)h(writable)g(or)g(for)g
(the)f(pipe)g(to)150 5254 y(become)k(r)n(eadable.)51
b(If)30 b(select)f(r)n(eturns)g(that)h(just)f(sock)g(is)h(writable)h
(then)e(the)h(connection)f(has)150 5367 y(succeeded.)58
b(It)33 b(then)f(needs)g(to)g(set)g(the)h(socket)f(back)i(to)e
(blocking)i(mode)f(using)f(fcntl\(sock,)150 5479 y(F)p
206 5479 V 32 w(SETFL,)f(0\).)61 b(If)33 b(instead)f(select)h(r)n
(eturns)f(that)g(the)h(pipe)f(is)i(r)n(eadable,)i(thr)n(ead)d(A)g
(closes)f(the)150 5592 y(socket,)21 b(tidies)h(up)g(and)g(exits.)p
eop
%%Page: 6 6
6 5 bop 30 100 a Ff(6)2793 b Fc(REFERENCES)171 399 y
Ff(An)26 b(alternative)i(method)d(is)i(similar)h(but)e(to)g(use)g
(polling)h(instead)f(of)g(the)g(pipe.)39 b(Thr)n(ead)26
b(B)30 511 y(justs)20 b(sets)g(a)h(\003ag)h(and)f(thr)n(ead)g(A)g
(calls)h(select)e(with)h(a)h(timeout,)e(periodically)i(waking)f(up)g
(to)f(see)30 624 y(if)j(the)f(\003ag)h(has)g(been)f(set.)30
923 y Fg(References)30 1134 y Ff([POSIX94])46 b Fa(Portable)i
(Operating)f(System)f(Interface)i(\(POSIX\))d(Thr)n(eads)j(Extension)p
Ff(,)k(P1003.1c)212 1247 y(Draft)23 b(10,)h(IEEE,)d(September)f(1994.)
30 1435 y([Birr)n(ell89])48 b Fa(An)21 b(Intr)n(oduction)j(to)f(Pr)n
(ogramming)h(with)f(Thr)n(eads)p Ff(,)i(Resear)n(ch)c(Report)g(35,)i
(DEC)g(Sys-)212 1547 y(tems)f(Resear)n(ch)g(Center)-7
b(,)22 b(Palo)h(Alto,)f(CA,)g(January)h(1989.)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
